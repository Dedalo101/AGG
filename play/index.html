<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alien Abduction Simulator | AGG Homes</title>
    <style>
        body { 
            background: #000; 
            color: lime; 
            font-family: monospace; 
            text-align: center; 
        }
        .permission-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .permission-box {
            border: 2px solid lime;
            padding: 20px;
            max-width: 400px;
            text-align: center;
        }
        .permission-btn {
            background: lime;
            color: black;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
            font-family: monospace;
            font-size: 16px;
        }
        video { 
            border: 2px solid lime; 
            width: 400px; 
            height: 300px;
            display: none;
        }
        #photo { 
            display: none; 
            width: 200px; 
            height: 150px; 
        }
        .home-link {
            position: fixed;
            top: 10px;
            left: 10px;
            color: lime;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <a href="/" class="home-link">‚Üê Back to AGG Homes</a>
    <div id="permissionOverlay" class="permission-overlay">
        <div class="permission-box">
            <h2>üõ∏ Alien Detection System</h2>
            <p>To scan for extraterrestrial activity, we need:</p>
            <ul style="text-align: left;">
                <li>Camera access (to detect alien presence)</li>
                <li>Microphone access (to analyze alien signals)</li>
            </ul>
            <button id="requestPermissions" class="permission-btn">Grant Access</button>
            <p style="font-size: 12px;">Your data stays local and is not stored.</p>
        </div>
    </div>

    <h1>Alien Abduction Simulator</h1>
    <video id="video" autoplay muted playsinline></video>
    <canvas id="canvas" style="display: none;"></canvas>
    <img id="photo" alt="Abducted!">
    <div id="message">Awaiting alien contact...</div>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const photo = document.getElementById('photo');
        const message = document.getElementById('message');
        const permissionOverlay = document.getElementById('permissionOverlay');
        const requestPermissionsBtn = document.getElementById('requestPermissions');

        let stream = null;

        requestPermissionsBtn.addEventListener('click', async () => {
            try {
                // Request both permissions
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' }, 
                    audio: true 
                });
                
                // Hide overlay and show video on success
                permissionOverlay.style.display = 'none';
                video.style.display = 'block';
                video.srcObject = stream;
                
                // Start alien detection
                startAlienDetection(stream);
                
            } catch (err) {
                message.textContent = `Access denied: ${err.message}. Aliens are disappointed!`;
                console.error('Permission error:', err);
            }
        });

        function startAlienDetection(stream) {
            // Audio analysis setup
            const audioContext = new AudioContext();
            const source = audioContext.createMediaStreamSource(stream);
            const analyser = audioContext.createAnalyser();
            source.connect(analyser);
            const dataArray = new Uint8Array(analyser.frequencyBinCount);

            // Funny messages for "detections"
            const alienMessages = [
                "üëΩ Alien signal detected! They want your pizza recipe!",
                "üõ∏ UFO approaching... They're impressed by your dance moves!",
                "üëæ Extraterrestrial transmission: 'Nice haircut, human!'",
                "üåå Alien scan complete: You're 0.01% Martian!",
                "üöÄ Warning: High levels of awesome detected!"
            ];

            // Check for "alien signals"
            setInterval(() => {
                analyser.getByteFrequencyData(dataArray);
                const volume = dataArray.reduce((a, b) => a + b) / dataArray.length;
                
                if (volume > 50) {
                    capturePhoto();
                    message.textContent = alienMessages[Math.floor(Math.random() * alienMessages.length)];
                }
            }, 100);
        }

        function capturePhoto() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Capture base photo
            ctx.drawImage(video, 0, 0);
            
            // Add UFO hat overlay
            ctx.fillStyle = 'rgba(150, 150, 150, 0.7)';
            ctx.beginPath();
            ctx.ellipse(canvas.width/2, 50, 80, 30, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Add alien effects
            ctx.strokeStyle = 'lime';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 0, canvas.width, canvas.height);
            
            // Display the result
            photo.src = canvas.toDataURL('image/png');
            photo.style.display = 'block';
        }
    </script>
</body>
</html>
